# Shamba-Diva Middleware

## Introduction

1. This script is created as a middleware for [Diva Protocol](https://www.divaprotocol.io/) interaction with [Shamba Geospatial Oracle](https://shamba.network).

2. It is deployed as a [GCP Cloud Function](https://cloud.google.com/functions) with trigger-type as [GCP Pub/Sub](https://cloud.google.com/functions/docs/calling/pubsub) based on [GCP Cloud Scheduler](https://cloud.google.com/scheduler) scheduled at 00:00 UTC everyday. 

## What it does ?

It fetches all the **eligible expired pools** created using [Diva Protocol App](https://app.diva.finance/) from the [Diva Graph](https://thegraph.com/hosted-service/subgraph/divaprotocol/diva-polygon-pilot). 

### What are eligible expired pools ?

Being Shamba Network as Geospatial Data Provider, the eligible expired pools means the pools whose expiry date is passed and it's not being 7 days after expiry. And also while creating the pool, the **Reference Asset** and the **Data Provider** selected as the [IPFS](https://web3.storage/) url of the Geo-JSON file and the [Shamba Network's Wallet Address](https://polygonscan.com/address/0xbf405c325841545033920F59E9Aa9fe3d9c3c517) (i.e., `0xbf405c325841545033920F59E9Aa9fe3d9c3c517`) respectively. 

Below is the content of a sample Geo-JSON file:

```
{
    "agg_x": "agg_mean",
    "dataset": "eVIIRS_NDVI",
    "band": "NDVI",
    "scale": "1000",
    "start_date": "2023-03-01",
    "end_date": "2023-05-31",
    "offset": 1,
    "geometry": {
        "type": "FeatureCollection",
        "features": [
            {
                "type": "Feature",
                "properties": {
                    "id": 1
                },
                "geometry": {
                    "type": "Polygon",
                    "coordinates": [
                        [
                            [
                                36.60130692,
                                2.40547466
                            ],
                            [
                                36.60438919,
                                2.40238571
                            ],
                            [
                                36.60571289,
                                2.39752197
                            ],
                            [
                                36.60827637,
                                2.39568996
                            ],
                            [
                                36.61611557,
                                2.39723945
                            ],
                            [
                                36.61968994,
                                2.39910889
                            ],
                            [
                                36.62130737,
                                2.40310693
                            ],
                            [
                                36.62187958,
                                2.40715766
                            ],
                            [
                                36.62114334,
                                2.41231894
                            ],
                            [
                                36.62182236,
                                2.41358519
                            ],
                            [
                                36.62308884,
                                2.41455889
                            ],
                            [
                                36.62646103,
                                2.41423631
                            ],
                            [
                                36.63146591,
                                2.41183209
                            ],
                            [
                                36.63177872,
                                2.4093821
                            ],
                            [
                                36.63563538,
                                2.40452242
                            ],
                            [
                                36.63801575,
                                2.40619564
                            ],
                            [
                                36.63916016,
                                2.41027379
                            ],
                            [
                                36.64003372,
                                2.40968943
                            ],
                            [
                                36.63909912,
                                2.40112305
                            ],
                            [
                                36.63952637,
                                2.39367676
                            ],
                            [
                                36.64147949,
                                2.39648437
                            ],
                            [
                                36.64383316,
                                2.40540457
                            ],
                            [
                                36.64349365,
                                2.41491699
                            ],
                            [
                                36.64447021,
                                2.41748047
                            ],
                            [
                                36.64788818,
                                2.41333008
                            ],
                            [
                                36.65064621,
                                2.41780782
                            ],
                            [
                                36.65219879,
                                2.41870117
                            ],
                            [
                                36.65692139,
                                2.41931152
                            ],
                            [
                                36.66223907,
                                2.42994642
                            ],
                            [
                                36.67168808,
                                2.44455457
                            ],
                            [
                                36.68551636,
                                2.45779943
                            ],
                            [
                                36.68796539,
                                2.45848131
                            ],
                            [
                                36.69567871,
                                2.45452881
                            ],
                            [
                                36.69873047,
                                2.45428467
                            ],
                            [
                                36.69970703,
                                2.45709229
                            ],
                            [
                                36.69788361,
                                2.46515942
                            ],
                            [
                                36.70330811,
                                2.47607422
                            ],
                            [
                                36.70367432,
                                2.47930908
                            ],
                            [
                                36.7019043,
                                2.48651123
                            ],
                            [
                                36.70269775,
                                2.49749756
                            ],
                            [
                                36.70022202,
                                2.51262927
                            ],
                            [
                                36.7061615,
                                2.51223969
                            ],
                            [
                                36.7073288,
                                2.51146054
                            ],
                            [
                                36.7086792,
                                2.50811768
                            ],
                            [
                                36.71551514,
                                2.50830078
                            ],
                            [
                                36.72590256,
                                2.51147699
                            ],
                            [
                                36.73966217,
                                2.51418757
                            ],
                            [
                                36.74871826,
                                2.51391602
                            ],
                            [
                                36.75193405,
                                2.51555085
                            ],
                            [
                                36.75970459,
                                2.51550293
                            ],
                            [
                                36.76550293,
                                2.49371338
                            ],
                            [
                                36.77167892,
                                2.47932363
                            ],
                            [
                                36.84472656,
                                2.27490234
                            ],
                            [
                                36.85273743,
                                2.26587725
                            ],
                            [
                                36.86461258,
                                2.25445223
                            ],
                            [
                                36.89227295,
                                2.19567871
                            ],
                            [
                                36.89490128,
                                2.19270778
                            ],
                            [
                                36.90162277,
                                2.15725827
                            ],
                            [
                                36.91379547,
                                2.12638617
                            ],
                            [
                                36.91192627,
                                2.10491943
                            ],
                            [
                                36.91448975,
                                2.10211182
                            ],
                            [
                                36.91885757,
                                2.10135722
                            ],
                            [
                                36.91895676,
                                2.08470392
                            ],
                            [
                                36.92177963,
                                2.06045413
                            ],
                            [
                                36.91963959,
                                2.05344224
                            ],
                            [
                                36.92022324,
                                2.04954648
                            ],
                            [
                                36.91934586,
                                2.03513312
                            ],
                            [
                                36.91650391,
                                2.02252197
                            ],
                            [
                                36.91748047,
                                2.01867676
                            ],
                            [
                                36.92108154,
                                2.0178833
                            ],
                            [
                                36.92449951,
                                2.01812744
                            ],
                            [
                                36.92810059,
                                2.01947021
                            ],
                            [
                                36.9375,
                                2.02532959
                            ],
                            [
                                36.94750977,
                                2.0269165
                            ],
                            [
                                36.9520874,
                                2.02532959
                            ],
                            [
                                36.96087646,
                                2.01812744
                            ],
                            [
                                36.97650146,
                                2.00872803
                            ],
                            [
                                36.99768066,
                                1.99969482
                            ],
                            [
                                37.00517273,
                                1.98973203
                            ],
                            [
                                37.00848389,
                                1.98608398
                            ],
                            [
                                37.01147461,
                                1.98449707
                            ],
                            [
                                37.07533646,
                                1.98250997
                            ],
                            [
                                37.07801437,
                                1.98208153
                            ],
                            [
                                37.09307861,
                                1.97467041
                            ],
                            [
                                37.11848831,
                                1.969082
                            ],
                            [
                                37.12231445,
                                1.96728516
                            ],
                            [
                                37.15873718,
                                1.96351016
                            ],
                            [
                                37.16131592,
                                1.96429443
                            ],
                            [
                                37.16369247,
                                1.9411
                            ],
                            [
                                37.17150879,
                                1.92730713
                            ],
                            [
                                37.17590332,
                                1.92211914
                            ],
                            [
                                37.18106842,
                                1.91809881
                            ],
                            [
                                37.21945953,
                                1.89151931
                            ],
                            [
                                37.22967529,
                                1.87689209
                            ],
                            [
                                37.23431396,
                                1.87188721
                            ],
                            [
                                37.27392578,
                                1.86968994
                            ],
                            [
                                37.30529785,
                                1.75170898
                            ],
                            [
                                37.34431839,
                                1.73659444
                            ],
                            [
                                37.3588829,
                                1.7296344
                            ],
                            [
                                37.40679169,
                                1.65435874
                            ],
                            [
                                37.40869141,
                                1.65270996
                            ],
                            [
                                37.41080856,
                                1.65212214
                            ],
                            [
                                37.40869141,
                                1.65252686
                            ],
                            [
                                37.41210938,
                                1.64611816
                            ],
                            [
                                37.44708252,
                                1.5916748
                            ],
                            [
                                37.4755249,
                                1.54931641
                            ],
                            [
                                37.49987793,
                                1.50048828
                            ],
                            [
                                37.55712891,
                                1.39935493
                            ],
                            [
                                37.55850601,
                                1.40036511
                            ],
                            [
                                37.56113815,
                                1.39880693
                            ],
                            [
                                37.56308365,
                                1.39471662
                            ],
                            [
                                37.56454468,
                                1.3937428
                            ],
                            [
                                37.56892776,
                                1.39354801
                            ],
                            [
                                37.57058334,
                                1.39237916
                            ],
                            [
                                37.57418823,
                                1.38439357
                            ],
                            [
                                37.57662201,
                                1.38458824
                            ],
                            [
                                37.57778931,
                                1.3837117
                            ],
                            [
                                37.58226776,
                                1.37601805
                            ],
                            [
                                37.58229446,
                                1.3690815
                            ],
                            [
                                37.58830643,
                                1.37202513
                            ],
                            [
                                37.58996201,
                                1.38156915
                            ],
                            [
                                37.5970726,
                                1.38809419
                            ],
                            [
                                37.59765625,
                                1.39413238
                            ],
                            [
                                37.59892273,
                                1.39520359
                            ],
                            [
                                37.60067749,
                                1.39315844
                            ],
                            [
                                37.60281754,
                                1.38614643
                            ],
                            [
                                37.60486221,
                                1.38225091
                            ],
                            [
                                37.60934448,
                                1.37893975
                            ],
                            [
                                37.61119461,
                                1.37893975
                            ],
                            [
                                37.61353302,
                                1.3793292
                            ],
                            [
                                37.61771774,
                                1.38156927
                            ],
                            [
                                37.62200546,
                                1.3809849
                            ],
                            [
                                37.62292862,
                                1.38148963
                            ],
                            [
                                37.62282944,
                                1.38528156
                            ],
                            [
                                37.62424469,
                                1.38731515
                            ],
                            [
                                37.63028336,
                                1.38750994
                            ],
                            [
                                37.63339996,
                                1.39160025
                            ],
                            [
                                37.64031219,
                                1.3951062
                            ],
                            [
                                37.64771652,
                                1.40231299
                            ],
                            [
                                37.6540451,
                                1.40484512
                            ],
                            [
                                37.65589523,
                                1.40377378
                            ],
                            [
                                37.65871811,
                                1.39890432
                            ],
                            [
                                37.66242218,
                                1.4022156
                            ],
                            [
                                37.66485596,
                                1.40153384
                            ],
                            [
                                37.67040634,
                                1.40309215
                            ],
                            [
                                37.67284012,
                                1.40591633
                            ],
                            [
                                37.67692947,
                                1.40727973
                            ],
                            [
                                37.68335724,
                                1.40279996
                            ],
                            [
                                37.68521118,
                                1.40299463
                            ],
                            [
                                37.69309616,
                                1.40659809
                            ],
                            [
                                37.71355057,
                                1.41175961
                            ],
                            [
                                37.71997833,
                                1.41175961
                            ],
                            [
                                37.72660065,
                                1.41049361
                            ],
                            [
                                37.73643494,
                                1.41078579
                            ],
                            [
                                37.74782944,
                                1.41701865
                            ],
                            [
                                37.75679016,
                                1.41555786
                            ],
                            [
                                37.76302338,
                                1.4178952
                            ],
                            [
                                37.77013397,
                                1.41828465
                            ],
                            [
                                37.77256775,
                                1.41672635
                            ],
                            [
                                37.77821732,
                                1.41555822
                            ],
                            [
                                37.77987289,
                                1.41721344
                            ],
                            [
                                37.78152847,
                                1.42227757
                            ],
                            [
                                37.78279114,
                                1.42315412
                            ],
                            [
                                37.78522873,
                                1.42247236
                            ],
                            [
                                37.7888298,
                                1.41877162
                            ],
                            [
                                37.79506302,
                                1.41838205
                            ],
                            [
                                37.80051804,
                                1.42227757
                            ],
                            [
                                37.80869675,
                                1.42140114
                            ],
                            [
                                37.81064606,
                                1.42188811
                            ],
                            [
                                37.81765747,
                                1.42675745
                            ],
                            [
                                37.81980133,
                                1.42675745
                            ],
                            [
                                37.82593536,
                                1.42442024
                            ],
                            [
                                37.82759094,
                                1.42461491
                            ],
                            [
                                37.83216858,
                                1.42919219
                            ],
                            [
                                37.84278488,
                                1.42938697
                            ],
                            [
                                37.84491348,
                                1.43231714
                            ],
                            [
                                37.84375763,
                                1.43328249
                            ],
                            [
                                37.84434128,
                                1.43591201
                            ],
                            [
                                37.84706879,
                                1.43873632
                            ],
                            [
                                37.84658051,
                                1.44681954
                            ],
                            [
                                37.85018539,
                                1.45032549
                            ],
                            [
                                37.85131836,
                                1.45629883
                            ],
                            [
                                37.85351562,
                                1.45928955
                            ],
                            [
                                37.95150757,
                                1.38748729
                            ],
                            [
                                37.94642639,
                                1.26359546
                            ],
                            [
                                38.01989746,
                                1.32147217
                            ],
                            [
                                38.21368408,
                                1.47790527
                            ],
                            [
                                38.21870041,
                                1.47968876
                            ],
                            [
                                38.2230835,
                                1.48529053
                            ],
                            [
                                38.23291016,
                                1.49328613
                            ],
                            [
                                38.3414917,
                                1.57867432
                            ],
                            [
                                38.38232422,
                                1.7545166
                            ],
                            [
                                38.38470459,
                                1.76190186
                            ],
                            [
                                38.5178833,
                                1.83947754
                            ],
                            [
                                38.78869629,
                                1.99487305
                            ],
                            [
                                38.83551025,
                                2.02612305
                            ],
                            [
                                38.9520874,
                                2.09368896
                            ],
                            [
                                38.96118927,
                                2.09983611
                            ],
                            [
                                38.95549774,
                                2.10571551
                            ],
                            [
                                38.95365906,
                                2.11007524
                            ],
                            [
                                38.95149612,
                                2.11599302
                            ],
                            [
                                38.95092773,
                                2.12109375
                            ],
                            [
                                38.94927979,
                                2.12591553
                            ],
                            [
                                38.94311523,
                                2.14349365
                            ],
                            [
                                38.94049454,
                                2.14821219
                            ],
                            [
                                38.93697357,
                                2.15964413
                            ],
                            [
                                38.9360199,
                                2.16663814
                            ],
                            [
                                38.93716812,
                                2.17658257
                            ],
                            [
                                38.93645477,
                                2.19606185
                            ],
                            [
                                38.9376297,
                                2.21433926
                            ],
                            [
                                38.93395233,
                                2.24267673
                            ],
                            [
                                38.93212891,
                                2.25109863
                            ],
                            [
                                38.92847824,
                                2.26064706
                            ],
                            [
                                38.92810059,
                                2.27471924
                            ],
                            [
                                38.92572021,
                                2.28192139
                            ],
                            [
                                38.92987061,
                                2.29907227
                            ],
                            [
                                38.93572998,
                                2.31469727
                            ],
                            [
                                38.93127441,
                                2.34289551
                            ],
                            [
                                38.93170166,
                                2.35430908
                            ],
                            [
                                38.93389893,
                                2.36151123
                            ],
                            [
                                38.93432617,
                                2.37030029
                            ],
                            [
                                38.93389893,
                                2.37390137
                            ],
                            [
                                38.93048096,
                                2.38128662
                            ],
                            [
                                38.93029785,
                                2.39227295
                            ],
                            [
                                38.92828369,
                                2.40808105
                            ],
                            [
                                38.92749023,
                                2.41271973
                            ],
                            [
                                38.92230225,
                                2.42211914
                            ],
                            [
                                38.92021561,
                                2.42967129
                            ],
                            [
                                38.91467285,
                                2.43951416
                            ],
                            [
                                38.91369629,
                                2.44232178
                            ],
                            [
                                38.91308975,
                                2.45068431
                            ],
                            [
                                38.90228271,
                                2.47808838
                            ],
                            [
                                38.89849854,
                                2.49847412
                            ],
                            [
                                38.89587402,
                                2.50372314
                            ],
                            [
                                38.89331055,
                                2.51330566
                            ],
                            [
                                38.89050293,
                                2.51989746
                            ],
                            [
                                38.89227295,
                                2.51708984
                            ],
                            [
                                38.89312744,
                                2.52191162
                            ],
                            [
                                38.89147949,
                                2.53588867
                            ],
                            [
                                38.88812256,
                                2.54370117
                            ],
                            [
                                38.89508057,
                                2.54650879
                            ],
                            [
                                38.96411133,
                                2.56427002
                            ],
                            [
                                38.97888184,
                                2.5690918
                            ],
                            [
                                38.99591064,
                                2.59869385
                            ],
                            [
                                39.00372314,
                                2.61029053
                            ],
                            [
                                39.03149414,
                                2.67687988
                            ],
                            [
                                39.03710938,
                                2.69207764
                            ],
                            [
                                39.04510498,
                                2.69873047
                            ],
                            [
                                39.04852295,
                                2.70349121
                            ],
                            [
                                39.04949951,
                                2.70648193
                            ],
                            [
                                39.04949951,
                                2.71447754
                            ],
                            [
                                39.05108643,
                                2.72131348
                            ],
                            [
                                39.05529785,
                                2.72991943
                            ],
                            [
                                39.06152344,
                                2.73529053
                            ],
                            [
                                39.0625,
                                2.73828125
                            ],
                            [
                                39.07012939,
                                2.80389404
                            ],
                            [
                                39.06732178,
                                2.88311768
                            ],
                            [
                                39.09588623,
                                2.88287354
                            ],
                            [
                                39.1071167,
                                2.88427734
                            ],
                            [
                                39.11212158,
                                2.88409424
                            ],
                            [
                                39.11328125,
                                2.88751221
                            ],
                            [
                                39.11730957,
                                2.91229248
                            ],
                            [
                                39.12591553,
                                2.93389893
                            ],
                            [
                                39.12487793,
                                2.93688965
                            ],
                            [
                                39.12689209,
                                2.93469238
                            ],
                            [
                                39.1361084,
                                2.93707275
                            ],
                            [
                                39.13830566,
                                2.93847656
                            ],
                            [
                                39.14068604,
                                2.94067383
                            ],
                            [
                                39.14868164,
                                2.953125
                            ],
                            [
                                39.15167236,
                                2.95452881
                            ],
                            [
                                39.19390869,
                                2.95648193
                            ],
                            [
                                39.20031738,
                                2.9664917
                            ],
                            [
                                39.21738815,
                                2.9780221
                            ],
                            [
                                39.22467041,
                                2.97930908
                            ],
                            [
                                39.23748779,
                                2.98468018
                            ],
                            [
                                39.24188232,
                                2.98571777
                            ],
                            [
                                39.24550247,
                                2.98548794
                            ],
                            [
                                39.25012207,
                                2.98907471
                            ],
                            [
                                39.25030518,
                                2.99530029
                            ],
                            [
                                39.25708008,
                                3.00372314
                            ],
                            [
                                39.26647949,
                                3.01391602
                            ],
                            [
                                39.28112793,
                                3.02770996
                            ],
                            [
                                39.28967285,
                                3.03747559
                            ],
                            [
                                39.31048584,
                                3.04711914
                            ],
                            [
                                39.32452393,
                                3.05487061
                            ],
                            [
                                39.34527588,
                                3.07067871
                            ],
                            [
                                39.34588623,
                                3.08691406
                            ],
                            [
                                39.34552002,
                                3.11547852
                            ],
                            [
                                39.34368896,
                                3.15991211
                            ],
                            [
                                39.34197998,
                                3.25082922
                            ],
                            [
                                39.33817291,
                                3.27843094
                            ],
                            [
                                39.33703232,
                                3.28085208
                            ],
                            [
                                39.32798767,
                                3.28858542
                            ],
                            [
                                39.32537079,
                                3.31523538
                            ],
                            [
                                39.3126297,
                                3.40787363
                            ],
                            [
                                39.3092041,
                                3.41463137
                            ],
                            [
                                39.3054924,
                                3.41824818
                            ],
                            [
                                39.3000679,
                                3.42938399
                            ],
                            [
                                39.29873276,
                                3.44347048
                            ],
                            [
                                39.30301666,
                                3.45555806
                            ],
                            [
                                39.3092041,
                                3.46222067
                            ],
                            [
                                39.31072617,
                                3.46564698
                            ],
                            [
                                39.31428528,
                                3.46883082
                            ],
                            [
                                39.30772781,
                                3.46964741
                            ],
                            [
                                39.30823517,
                                3.47733569
                            ],
                            [
                                39.29883575,
                                3.47693825
                            ],
                            [
                                39.27994537,
                                3.4728682
                            ],
                            [
                                39.23405457,
                                3.47703838
                            ],
                            [
                                39.20045471,
                                3.47910833
                            ],
                            [
                                39.17510605,
                                3.49070835
                            ],
                            [
                                39.13492584,
                                3.51058841
                            ],
                            [
                                39.10645676,
                                3.51911855
                            ],
                            [
                                39.09286499,
                                3.5339787
                            ],
                            [
                                39.08083725,
                                3.53862858
                            ],
                            [
                                39.07385635,
                                3.53452849
                            ],
                            [
                                39.06570053,
                                3.52791357
                            ],
                            [
                                39.04681396,
                                3.5215385
                            ],
                            [
                                39.03139496,
                                3.52451873
                            ],
                            [
                                39.02421951,
                                3.52193356
                            ],
                            [
                                39.01528549,
                                3.51278853
                            ],
                            [
                                39.00167465,
                                3.52092862
                            ],
                            [
                                38.98322678,
                                3.52031875
                            ],
                            [
                                38.96271515,
                                3.52823877
                            ],
                            [
                                38.94687653,
                                3.51286864
                            ],
                            [
                                38.93405151,
                                3.51130867
                            ],
                            [
                                38.90764999,
                                3.50965881
                            ],
                            [
                                38.89591599,
                                3.51151872
                            ],
                            [
                                38.856884,
                                3.52585888
                            ],
                            [
                                38.83628464,
                                3.53176379
                            ],
                            [
                                38.82889557,
                                3.53220892
                            ],
                            [
                                38.78110504,
                                3.547189
                            ],
                            [
                                38.77539063,
                                3.54992414
                            ],
                            [
                                38.71240234,
                                3.56909895
                            ],
                            [
                                38.70850754,
                                3.57494402
                            ],
                            [
                                38.70578003,
                                3.58249402
                            ],
                            [
                                38.69062042,
                                3.60358405
                            ],
                            [
                                38.68354416,
                                3.61730409
                            ],
                            [
                                38.67786789,
                                3.62154913
                            ],
                            [
                                38.67037582,
                                3.61977911
                            ],
                            [
                                38.66923904,
                                3.61465907
                            ],
                            [
                                38.67055893,
                                3.60922408
                            ],
                            [
                                38.66864777,
                                3.60382915
                            ],
                            [
                                38.66241837,
                                3.59487915
                            ],
                            [
                                38.65518951,
                                3.59400415
                            ],
                            [
                                38.63049316,
                                3.60030913
                            ],
                            [
                                38.62504196,
                                3.60141921
                            ],
                            [
                                38.61845779,
                                3.60162425
                            ],
                            [
                                38.61037827,
                                3.60382915
                            ],
                            [
                                38.60974121,
                                3.61112928
                            ],
                            [
                                38.59614944,
                                3.60447907
                            ],
                            [
                                38.57243729,
                                3.60336924
                            ],
                            [
                                38.56824875,
                                3.6067543
                            ],
                            [
                                38.55320358,
                                3.61255932
                            ],
                            [
                                38.55132294,
                                3.6174593
                            ],
                            [
                                38.55201721,
                                3.62347436
                            ],
                            [
                                38.54790497,
                                3.62955427
                            ],
                            [
                                38.54388809,
                                3.63901687
                            ],
                            [
                                38.53724289,
                                3.64815927
                            ],
                            [
                                38.53275299,
                                3.65270925
                            ],
                            [
                                38.52151871,
                                3.65033937
                            ],
                            [
                                38.51359558,
                                3.64697766
                            ],
                            [
                                38.51689529,
                                3.6397593
                            ],
                            [
                                38.51735306,
                                3.62632418
                            ],
                            [
                                38.51100159,
                                3.62291431
                            ],
                            [
                                38.47618866,
                                3.61090422
                            ],
                            [
                                38.44875336,
                                3.62645578
                            ],
                            [
                                38.43719482,
                                3.60125875
                            ],
                            [
                                38.42982483,
                                3.6008594
                            ],
                            [
                                38.39599228,
                                3.60410428
                            ],
                            [
                                38.34168243,
                                3.60617948
                            ],
                            [
                                38.32943344,
                                3.60752439
                            ],
                            [
                                38.32235718,
                                3.60916615
                            ],
                            [
                                38.27761078,
                                3.6119194
                            ],
                            [
                                38.25342178,
                                3.61200953
                            ],
                            [
                                38.24529266,
                                3.61326957
                            ],
                            [
                                38.22558212,
                                3.61392951
                            ],
                            [
                                38.18845749,
                                3.6179595
                            ],
                            [
                                38.18096161,
                                3.61745453
                            ],
                            [
                                38.14383698,
                                3.60933447
                            ],
                            [
                                38.13300323,
                                3.60924459
                            ],
                            [
                                38.12617111,
                                3.60684204
                            ],
                            [
                                38.12028122,
                                3.60849953
                            ],
                            [
                                38.09680557,
                                3.63139963
                            ],
                            [
                                38.08272552,
                                3.6418047
                            ],
                            [
                                38.05083466,
                                3.66747642
                            ],
                            [
                                38.04486084,
                                3.6695447
                            ],
                            [
                                38.03453827,
                                3.68150973
                            ],
                            [
                                38.02858734,
                                3.68585491
                            ],
                            [
                                38.01385498,
                                3.70218229
                            ],
                            [
                                38.01298523,
                                3.70863318
                            ],
                            [
                                38.00947189,
                                3.71231484
                            ],
                            [
                                38.00526047,
                                3.71525979
                            ],
                            [
                                38.00253677,
                                3.72222996
                            ],
                            [
                                37.99589539,
                                3.72632003
                            ],
                            [
                                37.9851532,
                                3.729105
                            ],
                            [
                                37.96615219,
                                3.73846006
                            ],
                            [
                                37.94828033,
                                3.74908996
                            ],
                            [
                                37.92938232,
                                3.75909996
                            ],
                            [
                                37.91657257,
                                3.76851511
                            ],
                            [
                                37.90019989,
                                3.77769017
                            ],
                            [
                                37.8336525,
                                3.82331038
                            ],
                            [
                                37.8123703,
                                3.83657026
                            ],
                            [
                                37.80160522,
                                3.84443521
                            ],
                            [
                                37.78268051,
                                3.85557032
                            ],
                            [
                                37.73995972,
                                3.88692045
                            ],
                            [
                                37.7098999,
                                3.90487051
                            ],
                            [
                                37.6906395,
                                3.91911054
                            ],
                            [
                                37.66973877,
                                3.93297052
                            ],
                            [
                                37.64865875,
                                3.94678068
                            ],
                            [
                                37.63712692,
                                3.95310569
                            ],
                            [
                                37.6309967,
                                3.96246576
                            ],
                            [
                                37.61195374,
                                3.97443581
                            ],
                            [
                                37.59717941,
                                3.98503089
                            ],
                            [
                                37.58536911,
                                3.99061084
                            ],
                            [
                                37.58010483,
                                3.9944675
                            ],
                            [
                                37.57701492,
                                3.99862576
                            ],
                            [
                                37.56894684,
                                4.00263596
                            ],
                            [
                                37.55371857,
                                4.01226091
                            ],
                            [
                                37.53047943,
                                4.03133106
                            ],
                            [
                                37.51596832,
                                4.0394311
                            ],
                            [
                                37.5097084,
                                4.04663801
                            ],
                            [
                                37.40110779,
                                4.11818123
                            ],
                            [
                                37.3536377,
                                4.1468215
                            ],
                            [
                                37.32947922,
                                4.16425133
                            ],
                            [
                                37.26738739,
                                4.20369625
                            ],
                            [
                                37.24808502,
                                4.21752167
                            ],
                            [
                                37.22169495,
                                4.23333168
                            ],
                            [
                                37.19042206,
                                4.25416756
                            ],
                            [
                                37.16144943,
                                4.27018309
                            ],
                            [
                                37.12368774,
                                4.28277016
                            ],
                            [
                                37.1042366,
                                4.29878998
                            ],
                            [
                                37.08478165,
                                4.32548904
                            ],
                            [
                                37.05846405,
                                4.34303474
                            ],
                            [
                                37.03939438,
                                4.36172438
                            ],
                            [
                                36.99704742,
                                4.37890959
                            ],
                            [
                                36.98538208,
                                4.38528728
                            ],
                            [
                                36.98143768,
                                4.38922215
                            ],
                            [
                                36.97540665,
                                4.3911171
                            ],
                            [
                                36.96973801,
                                4.39449692
                            ],
                            [
                                36.95614624,
                                4.39668703
                            ],
                            [
                                36.94973755,
                                4.40421534
                            ],
                            [
                                36.94155121,
                                4.40738201
                            ],
                            [
                                36.93497849,
                                4.40893221
                            ],
                            [
                                36.91426849,
                                4.41824722
                            ],
                            [
                                36.89552689,
                                4.42489719
                            ],
                            [
                                36.87894058,
                                4.42822886
                            ],
                            [
                                36.86647797,
                                4.43179226
                            ],
                            [
                                36.83879852,
                                4.44395208
                            ],
                            [
                                36.79842758,
                                4.44300222
                            ],
                            [
                                36.71258163,
                                4.43924809
                            ],
                            [
                                36.65639877,
                                4.44002295
                            ],
                            [
                                36.64031982,
                                4.44988489
                            ],
                            [
                                36.61686325,
                                4.44980907
                            ],
                            [
                                36.54282761,
                                4.43965292
                            ],
                            [
                                36.45394135,
                                4.4430685
                            ],
                            [
                                36.39717865,
                                4.43915319
                            ],
                            [
                                36.3527298,
                                4.44271135
                            ],
                            [
                                36.26509857,
                                4.44363022
                            ],
                            [
                                36.24407578,
                                4.45470095
                            ],
                            [
                                36.20943832,
                                4.44481421
                            ],
                            [
                                36.15552521,
                                4.44627476
                            ],
                            [
                                36.14363861,
                                4.44789982
                            ],
                            [
                                36.11417389,
                                4.45002985
                            ],
                            [
                                36.08837891,
                                4.4488349
                            ],
                            [
                                36.05210495,
                                4.44917679
                            ],
                            [
                                36.05029297,
                                4.44632626
                            ],
                            [
                                36.04948425,
                                4.27867222
                            ],
                            [
                                36.04977417,
                                3.98516607
                            ],
                            [
                                36.05059052,
                                3.6535871
                            ],
                            [
                                36.05212402,
                                3.23852539
                            ],
                            [
                                36.06109619,
                                3.23370361
                            ],
                            [
                                36.06872559,
                                3.22808838
                            ],
                            [
                                36.07409668,
                                3.22589111
                            ],
                            [
                                36.08331299,
                                3.2255249
                            ],
                            [
                                36.10131836,
                                3.22052002
                            ],
                            [
                                36.11090088,
                                3.22070313
                            ],
                            [
                                36.1151123,
                                3.21868896
                            ],
                            [
                                36.12091064,
                                3.21331787
                            ],
                            [
                                36.13787842,
                                3.2086792
                            ],
                            [
                                36.14129639,
                                3.2098999
                            ],
                            [
                                36.14227295,
                                3.21191406
                            ],
                            [
                                36.14147949,
                                3.21392822
                            ],
                            [
                                36.13989258,
                                3.21490479
                            ],
                            [
                                36.14129639,
                                3.21911621
                            ],
                            [
                                36.144104,
                                3.22271729
                            ],
                            [
                                36.14611816,
                                3.22332764
                            ],
                            [
                                36.14849854,
                                3.22167969
                            ],
                            [
                                36.15167236,
                                3.21472168
                            ],
                            [
                                36.15148926,
                                3.19812012
                            ],
                            [
                                36.1505127,
                                3.19067383
                            ],
                            [
                                36.13909912,
                                3.15667725
                            ],
                            [
                                36.13848877,
                                3.15148926
                            ],
                            [
                                36.13928223,
                                3.14892578
                            ],
                            [
                                36.1439209,
                                3.14532471
                            ],
                            [
                                36.14807129,
                                3.13867188
                            ],
                            [
                                36.1494751,
                                3.13470459
                            ],
                            [
                                36.15209961,
                                3.11712646
                            ],
                            [
                                36.1519165,
                                3.11029053
                            ],
                            [
                                36.14971924,
                                3.09552002
                            ],
                            [
                                36.15252686,
                                3.09112549
                            ],
                            [
                                36.15270996,
                                3.08648682
                            ],
                            [
                                36.1519165,
                                3.08148193
                            ],
                            [
                                36.14727783,
                                3.07409668
                            ],
                            [
                                36.14251709,
                                3.07373047
                            ],
                            [
                                36.14093018,
                                3.07250977
                            ],
                            [
                                36.13980865,
                                3.06555605
                            ],
                            [
                                36.14196396,
                                3.06181574
                            ],
                            [
                                36.14227295,
                                3.05328369
                            ],
                            [
                                36.14208984,
                                3.04571533
                            ],
                            [
                                36.14068604,
                                3.03649902
                            ],
                            [
                                36.13690186,
                                3.02947998
                            ],
                            [
                                36.1363945,
                                3.01797795
                            ],
                            [
                                36.13180542,
                                3.01446176
                            ],
                            [
                                36.12757492,
                                3.0074594
                            ],
                            [
                                36.12369537,
                                2.98647475
                            ],
                            [
                                36.12392044,
                                2.98491073
                            ],
                            [
                                36.12490463,
                                2.98410058
                            ],
                            [
                                36.12900543,
                                2.98579049
                            ],
                            [
                                36.12962341,
                                2.98543215
                            ],
                            [
                                36.12921906,
                                2.98120546
                            ],
                            [
                                36.13001633,
                                2.97917652
                            ],
                            [
                                36.13327408,
                                2.98266268
                            ],
                            [
                                36.13617325,
                                2.98458505
                            ],
                            [
                                36.13744354,
                                2.98429179
                            ],
                            [
                                36.13613892,
                                2.98070765
                            ],
                            [
                                36.13613892,
                                2.98002863
                            ],
                            [
                                36.13708496,
                                2.97991943
                            ],
                            [
                                36.1362915,
                                2.97528076
                            ],
                            [
                                36.13348389,
                                2.97009277
                            ],
                            [
                                36.13409424,
                                2.96850586
                            ],
                            [
                                36.13848877,
                                2.97027588
                            ],
                            [
                                36.15350342,
                                2.96972656
                            ],
                            [
                                36.16430664,
                                2.9677124
                            ],
                            [
                                36.17028809,
                                2.96911621
                            ],
                            [
                                36.17932129,
                                2.96728516
                            ],
                            [
                                36.19268799,
                                2.96911621
                            ],
                            [
                                36.203125,
                                2.96228027
                            ],
                            [
                                36.2175293,
                                2.9598999
                            ],
                            [
                                36.22271729,
                                2.95629883
                            ],
                            [
                                36.22491455,
                                2.95690918
                            ],
                            [
                                36.22509766,
                                2.9586792
                            ],
                            [
                                36.22729492,
                                2.95910645
                            ],
                            [
                                36.230896,
                                2.95770264
                            ],
                            [
                                36.23309326,
                                2.95849609
                            ],
                            [
                                36.23632813,
                                2.95751953
                            ],
                            [
                                36.24530029,
                                2.95129395
                            ],
                            [
                                36.24768066,
                                2.95068359
                            ],
                            [
                                36.2532959,
                                2.95367432
                            ],
                            [
                                36.25488281,
                                2.95611572
                            ],
                            [
                                36.25563431,
                                2.96559978
                            ],
                            [
                                36.25368118,
                                2.96950173
                            ],
                            [
                                36.25482559,
                                2.97044373
                            ],
                            [
                                36.25819016,
                                2.96378326
                            ],
                            [
                                36.25849152,
                                2.95971274
                            ],
                            [
                                36.26067734,
                                2.95214391
                            ],
                            [
                                36.26146698,
                                2.9389658
                            ],
                            [
                                36.26689148,
                                2.92643523
                            ],
                            [
                                36.26908493,
                                2.91480064
                            ],
                            [
                                36.2725029,
                                2.90888762
                            ],
                            [
                                36.28274918,
                                2.89640427
                            ],
                            [
                                36.29140854,
                                2.89255929
                            ],
                            [
                                36.29982758,
                                2.89239645
                            ],
                            [
                                36.31312561,
                                2.88393402
                            ],
                            [
                                36.31580353,
                                2.8833034
                            ],
                            [
                                36.32253265,
                                2.87862539
                            ],
                            [
                                36.33278275,
                                2.87452555
                            ],
                            [
                                36.3466835,
                                2.86731243
                            ],
                            [
                                36.35564804,
                                2.86674643
                            ],
                            [
                                36.36016846,
                                2.8655901
                            ],
                            [
                                36.36431885,
                                2.86212111
                            ],
                            [
                                36.36752701,
                                2.85597134
                            ],
                            [
                                36.37924576,
                                2.84493351
                            ],
                            [
                                36.38697433,
                                2.8319509
                            ],
                            [
                                36.38771057,
                                2.82317328
                            ],
                            [
                                36.39627838,
                                2.80388308
                            ],
                            [
                                36.40027237,
                                2.79626179
                            ],
                            [
                                36.40431976,
                                2.7910583
                            ],
                            [
                                36.4071579,
                                2.78433037
                            ],
                            [
                                36.41167831,
                                2.77839088
                            ],
                            [
                                36.41320038,
                                2.77355528
                            ],
                            [
                                36.41872025,
                                2.76751065
                            ],
                            [
                                36.42008591,
                                2.7553165
                            ],
                            [
                                36.421875,
                                2.74963999
                            ],
                            [
                                36.4213028,
                                2.74047875
                            ],
                            [
                                36.42471313,
                                2.73497534
                            ],
                            [
                                36.42928696,
                                2.72304392
                            ],
                            [
                                36.43217468,
                                2.71868134
                            ],
                            [
                                36.43922043,
                                2.71563268
                            ],
                            [
                                36.44358063,
                                2.71226883
                            ],
                            [
                                36.44673538,
                                2.71090221
                            ],
                            [
                                36.44726181,
                                2.70948315
                            ],
                            [
                                36.44557571,
                                2.70532155
                            ],
                            [
                                36.43811417,
                                2.6955018
                            ],
                            [
                                36.43385696,
                                2.68304467
                            ],
                            [
                                36.43609619,
                                2.66931152
                            ],
                            [
                                36.43469238,
                                2.65228271
                            ],
                            [
                                36.43811035,
                                2.64331055
                            ],
                            [
                                36.43829346,
                                2.63409424
                            ],
                            [
                                36.44207764,
                                2.6295166
                            ],
                            [
                                36.44268799,
                                2.62652588
                            ],
                            [
                                36.45349121,
                                2.61291504
                            ],
                            [
                                36.45568848,
                                2.61151123
                            ],
                            [
                                36.46392822,
                                2.60968018
                            ],
                            [
                                36.47052002,
                                2.61029053
                            ],
                            [
                                36.47290039,
                                2.60931396
                            ],
                            [
                                36.4743042,
                                2.60168457
                            ],
                            [
                                36.49353027,
                                2.57611084
                            ],
                            [
                                36.51489258,
                                2.56048584
                            ],
                            [
                                36.51611328,
                                2.55847168
                            ],
                            [
                                36.51751709,
                                2.55169678
                            ],
                            [
                                36.52480698,
                                2.53037715
                            ],
                            [
                                36.53018951,
                                2.5264039
                            ],
                            [
                                36.52990723,
                                2.50848389
                            ],
                            [
                                36.53112793,
                                2.50048828
                            ],
                            [
                                36.52789307,
                                2.49212646
                            ],
                            [
                                36.52752686,
                                2.48669434
                            ],
                            [
                                36.52947998,
                                2.47351074
                            ],
                            [
                                36.52490234,
                                2.45947266
                            ],
                            [
                                36.52439117,
                                2.45099306
                            ],
                            [
                                36.52557373,
                                2.44681811
                            ],
                            [
                                36.53203583,
                                2.43605375
                            ],
                            [
                                36.53876495,
                                2.41192865
                            ],
                            [
                                36.54178238,
                                2.40840769
                            ],
                            [
                                36.54781723,
                                2.40715003
                            ],
                            [
                                36.55269241,
                                2.40268588
                            ],
                            [
                                36.56039429,
                                2.40057969
                            ],
                            [
                                36.5663681,
                                2.4038806
                            ],
                            [
                                36.56824875,
                                2.40864635
                            ],
                            [
                                36.56998062,
                                2.4090364
                            ],
                            [
                                36.57608032,
                                2.40796757
                            ],
                            [
                                36.57950592,
                                2.41089106
                            ],
                            [
                                36.58664322,
                                2.41126847
                            ],
                            [
                                36.58934784,
                                2.41318607
                            ],
                            [
                                36.59170532,
                                2.41724157
                            ],
                            [
                                36.59296417,
                                2.41730452
                            ],
                            [
                                36.59387589,
                                2.41566968
                            ],
                            [
                                36.6023941,
                                2.40963364
                            ],
                            [
                                36.60237885,
                                2.408602
                            ],
                            [
                                36.60128784,
                                2.40949345
                            ],
                            [
                                36.60130692,
                                2.40547466
                            ]
                        ]
                    ]
                }
            }
        ]
    }
}
```

IPFS url of this file: https://bafybeidtkl65yfwl5zx7detidym47c2g777vb42ja72zwuk4zkrfihceju.ipfs.w3s.link/shamba-reference-asset.json

### Requesting the data from the Shamba Geospatial Oracle 

It sends the request to the Shamba Geospatial Oracle by fetching the request parameters from the Reference Asset (i.e., the url of the Geo-JSON file stored on IPFS) and then passing them as parameters to the [OracleFacingGeoConsumer Smart Contract](https://polygonscan.com/address/0xa86AC2eB05Fd8459eA07eC0cfD96722f4d75d02c) via `requestGeostatsData` function inherited from ShambaGeoConsumer contract available in [Shamba Smart Contract Kit](https://github.com/shambadynamic/shamba-smartcontractkit).

### Receiving the data from the Shamba Geospatial Oracle 

After the request being made, the corresponding response is received in the form of geostats-data (as 18 decimal integer representation) via `getGeostatsData` function.

### Setting the final reference value of the pool

After receiving the response from the Shamba Geospatial Oracle, the final reference value of the corresponding pool is set by calling the `setFinalReferenceValue` function of the [Diva Settlement Facet](https://polygonscan.com/address/0x6b6a542fe58d977189b607040cbb8a67f74fd161) through the [Diva Diamond Contract](https://polygonscan.com/address/0xFf7d52432B19521276962B67FFB432eCcA609148) by passing the parameters as `_poolId`, `_finalReferenceValue` having `geostats_data` (18 decimal integer representation) and `_allowChallenge` boolean as `true`.










